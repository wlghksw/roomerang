<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ê´€ì‹¬ê¸€ ëª©ë¡</title>

    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #F8F9FA;
        }

        /* âœ… ë„¤ë¹„ê²Œì´ì…˜ ë°” ìŠ¤íƒ€ì¼ */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: white;
            padding: 20px 50px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .logo img {
            height: 60px;
        }

        .nav-links {
            display: flex;
            justify-content: center;
            flex-grow: 1;
            gap: 50px;
        }

        .nav-links a {
            text-decoration: none;
            color: #777E90;
            font-weight: bold;
            font-size: 20px;
        }

        .nav-links a:hover {
            color: #505D96;
        }

        h1 {
            text-align: center;
            margin-top: 40px;
            color: #505D96;
        }

        /* âœ… í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
        }

        table, th, td {
            border: 1px solid #ddd;
        }

        th, td {
            padding: 15px;
            text-align: center;
        }

        th {
            background-color: #505D96;
            color: white;
        }

        td {
            background-color: white;
        }

        /* âœ… ì‚­ì œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .delete-button {
            width: 80px;
            height: 35px;
            font-size: 14px;
            font-weight: bold;
            color: white;
            background-color: #DC3545;
            border: none;
            border-radius: 8px;
            cursor: pointer;
        }

        .delete-button:hover {
            background-color: #C82333;
        }
    </style>
</head>
<body>

<!-- ğŸŒŸ ë©”ì¸ ì½˜í…ì¸  -->
<div layout:fragment="content">
    <h1>ê´€ì‹¬ê¸€ ëª©ë¡</h1>

    <table>
        <thead>
        <tr>
            <th>ì œëª©</th>
            <th>ê²Œì‹œíŒ</th>
            <th>ì‚­ì œ</th>
        </tr>
        </thead>

        <tbody>
        <tr th:each="post : ${favoritePosts}" th:id="|favorite-item-${post.postId}|">
            <td>
                <a th:href="@{/{path}/{postId}(path=${post.postType == 'MATCH' or post.postType == 'NO_ROOM' ? 'board/post' : 'share'}, postId=${post.postId})}"
                   th:text="${post.postTitle}" style="text-decoration: none; color: #505D96; font-weight: bold;">
                </a>
            </td>
            <td th:text="${post.postType == 'MATCH' ? 'ë§¤ì¹­í•´ë°©' : post.postType == 'NO_ROOM' ? 'ë§¤ì¹­í•´ë°©' : 'ë‚˜ëˆ”í•´ë°©'}"></td>
            <td>
                <button class="delete-button" th:onclick="|deleteFavorite(${post.postId})|">ì‚­ì œ</button>
            </td>
        </tr>
        </tbody>
    </table>

    <script th:inline="javascript">
        // ğŸ”¹ deleteFavorite í•¨ìˆ˜ ì •ì˜
        function deleteFavorite(postId) {
            let userId = [[${userId}]];

            if (!userId) {
                alert("ì‚¬ìš©ì ì •ë³´ê°€ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
                return;
            }

            fetch("/favorite/delete", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                },
                body: new URLSearchParams({ userId: userId, postId: postId })
            })
                .then(response => response.text())
                .then(result => {
                    if (result.trim() === "success") {
                        alert("ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
                        document.getElementById("favorite-item-" + postId).remove();
                    } else {
                        alert("ì‚­ì œ ì‹¤íŒ¨: ì„œë²„ì—ì„œ ì‚­ì œí•  ë°ì´í„°ë¥¼ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");
                    }
                })
                .catch(error => {
                    console.error("ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:", error);
                    alert("ì„œë²„ ì˜¤ë¥˜ ë°œìƒ. ë‹¤ì‹œ ì‹œë„í•´ ì£¼ì„¸ìš”.");
                });
        }

        window.deleteFavorite = deleteFavorite;
    </script>

</div>
</body>
</html>
